sgchess.chriscortese.net {
    # Caddy will automatically obtain and renew an HTTPS certificate 
    # for this domain using the simple HTTP-01 challenge.
    
    # --- Frontend: FrankenPHP / PHP Handler ---
    
    # Set the root directory for the PHP files
    root * /app/public
    
    # Serve PHP files using the built-in FrankenPHP/PHP handler
    php_server

    # --- Backend: FastAPI / Python Reverse Proxy ---
    
    # Define a matcher for all requests starting with /api/
    @api path /api/*
    
    # Handle API requests (path stripping is crucial for clean proxying)
    handle @api {
        # Remove the /api prefix before forwarding to the backend
        uri strip_prefix /api
        
        # Forward the request to the backend container (using its service name and port)
        reverse_proxy backend:8000
    }
    
    # --- File Server / Single Page App Fallback ---
    
    # Handle all requests that didn't match the @api handler above
    handle {
        # Try serving the file, otherwise fall back to index.php (SPA/Frontend routing)
        try_files {path} /index.php
        file_server
    }
    
    # --- Logging ---
    log
}
