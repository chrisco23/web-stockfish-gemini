sgchess.chriscortese.net {
    
    # 1. Global Directives
    root * /app/public
    
    # --- 2. Routing Logic: Solves the 'php_server' ordering error ---
    
    # Highest Priority: API Proxy
    handle /api/* {
        uri strip_prefix /api
        reverse_proxy backend:8000
    }
    
    # Fallback: Frontend Logic
    # Use 'route' to force Caddy to accept the php_server directive order
    route {
        handle {
            try_files {path} /index.php
            php_server
        }
    }
    
    # --- 3. Logging ---
    log
}
